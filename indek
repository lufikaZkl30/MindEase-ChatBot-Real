<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MindEase â€“ Ruang Cerita Jiwa</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(-45deg, #e0c3fc, #8ec5fc, #fbe2e3, #d2f7f1);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .glassmorphism {
      background: rgba(255, 255, 255, 0.45);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    /* scroll bar */
    #chat-box::-webkit-scrollbar { width: 6px; }
    #chat-box::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.15);
      border-radius: 10px;
    }

    /* bubble layout */
    #chat-box {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 20px;
      height: 70vh;
      overflow-y: auto;
      scroll-behavior: smooth;
    }

    #chat-box .justify-start div {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      border-radius: 18px 18px 18px 6px;
      max-width: 75%;
      padding: 12px 16px;
      line-height: 1.5;
      font-size: 0.95rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      animation: fadeIn 0.3s ease-in-out;
    }

    #chat-box .justify-end div {
      background: linear-gradient(to right, #8b5cf6, #6366f1);
      color: #fff;
      border-radius: 18px 18px 6px 18px;
      max-width: 75%;
      padding: 12px 16px;
      line-height: 1.5;
      font-size: 0.95rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* input bar */
    #chat-form {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      border-top: 1px solid rgba(0, 0, 0, 0.05);
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      position: sticky;
      bottom: 0;
    }

    #user-input {
      flex: 1;
      padding: 12px 18px;
      border-radius: 25px;
      border: none;
      background: rgba(255, 255, 255, 0.6);
      color: #333;
      font-size: 0.95rem;
    }

    #user-input::placeholder { color: #777; }

    button[type="submit"] {
      background: #fff;
      border: none;
      border-radius: 50%;
      padding: 12px 14px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    button[type="submit"]:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }
  </style>
</head>

<body class="flex items-center justify-center min-h-screen overflow-hidden">
  <div class="w-full max-w-lg mx-4 bg-transparent rounded-3xl flex flex-col h-[95vh] max-h-[800px] relative">
    <div class="glassmorphism w-full h-full rounded-3xl shadow-lg flex flex-col">
      <!-- Header -->
      <div class="p-5 text-center border-b border-black/10">
        <h1 class="text-2xl font-bold text-gray-800">MindEase</h1>
        <p class="text-sm text-gray-600">Ruang Cerita Jiwa</p>
      </div>

      <!-- Chat Box -->
      <div id="chat-box" class="flex-grow overflow-y-auto"></div>

      <!-- Typing Indicator -->
      <div id="typing-indicator" class="hidden px-6 pb-2">
        <div class="inline-block bg-gray-200/80 backdrop-blur-sm rounded-full rounded-bl-none p-3">
          <div class="flex items-center space-x-1">
            <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></div>
            <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-100"></div>
            <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-200"></div>
          </div>
        </div>
      </div>

      <!-- Input Form -->
      <form id="chat-form">
        <input id="user-input" type="text" placeholder="Ceritakan apa yang hatimu rasakan hari iniâ€¦" />
        <button type="submit">âœ¨</button>
      </form>
    </div>

    <div class="absolute bottom-4 right-4 text-black/20 opacity-50 pointer-events-none text-xs">
      crafted with calm souls by <b>lufikaZkl30 ðŸŒ¿</b>
    </div>
  </div>

  <script>
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const chatForm = document.getElementById('chat-form');
    const typingIndicator = document.getElementById('typing-indicator');

    const API_KEY = "";
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
    let chatHistory = [];

    const systemPrompt = `
      Kamu adalah MindEase, teman jiwa digital yang mendengarkan dengan penuh empati dan kehangatan.
      Fokus pada validasi perasaan, bukan memberi solusi. Gunakan bahasa lembut, tenang, dan suportif.
    `;

    function addMessage(text, sender) {
      const wrap = document.createElement('div');
      wrap.className = sender === 'user' ? 'flex justify-end w-full' : 'flex justify-start w-full';
      const bubble = document.createElement('div');
      bubble.textContent = text;
      wrap.appendChild(bubble);
      chatBox.appendChild(wrap);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function showTyping(isTyping) {
      typingIndicator.style.display = isTyping ? 'block' : 'none';
      if (isTyping) chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function sendMessage(e) {
      e.preventDefault();
      const msg = userInput.value.trim();
      if (!msg) return;
      addMessage(msg, 'user');
      chatHistory.push({ role: 'user', parts: [{ text: msg }] });
      userInput.value = '';
      showTyping(true);

      try {
        const payload = {
          contents: chatHistory,
          systemInstruction: { parts: [{ text: systemPrompt }] },
        };
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const data = await res.json();
        const reply = data?.candidates?.[0]?.content?.parts?.[0]?.text || '...';
        addMessage(reply, 'bot');
        chatHistory.push({ role: 'model', parts: [{ text: reply }] });
      } catch (err) {
        console.error(err);
        addMessage('Sepertinya ada sedikit jeda di ruang kita... coba lagi ya ðŸŒ¸', 'bot');
      } finally {
        showTyping(false);
      }
    }

    chatForm.addEventListener('submit', sendMessage);

    window.onload = () => {
      const welcome = "Selamat datang di Ruang Cerita Jiwa ðŸŒ™ Tarik napas perlahan... Aku di sini untuk mendengarkanmu.";
      addMessage(welcome, 'bot');
    };
  </script>
</body>
</html>
